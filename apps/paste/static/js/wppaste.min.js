var wppaste={build_lang_menu:function(){var a=wp_modelist.modes;a.sort(function(a,b){return a.caption<b.caption?-1:a.caption>b.caption?1:0});var b=document.createDocumentFragment(),c=document.createElement("option");$(c).attr({val:""});$(c).text("[none]");$(b).append(c);for(var d,e=0;e<a.length;e++)c=a[e],d=document.createElement("option"),$(d).attr({val:c.mode}),$(d).text(c.caption),$(b).append(d);$("#langselect").append(b)},build_theme_menu:function(){var a=wp_themelist.themes;a.sort(function(a,
b){return a.caption<b.caption?-1:a.caption>b.caption?1:0});for(var b=document.createDocumentFragment(),c,d,e=0;e<a.length;e++)c=wp_themelist.themes[e],d=document.createElement("option"),$(d).attr({val:c.theme}),$(d).text(c.caption),$(b).append(d);$("#themeselect").append(b)},get_paste_author:function(){return $("#paste-author-entry").val()},get_paste_title:function(){return $("#paste-title-entry").val()},get_selected_lang:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).text()},
get_selected_mode:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme_name:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).text()},load_paste_settings:function(a){var b=$.cookie("pastesettings"),c="",d="Python",e="Solarized Dark";a=a||{nolangset:!1};b&&(b=JSON.parse(b),
c=b.author||"",d=b.lang||"Python",e=b.theme||"Solarized Dark");a.nolangset||wppaste.set_selected_mode(d);wppaste.set_selected_theme(e);$("#paste-author-entry").val(c)},on_mode_change:function(){var a=wppaste.get_selected_mode();wp_content.getSession().setMode(a);wppaste.update_paste_settings({lang:wppaste.get_selected_lang()})},on_theme_change:function(){var a=wppaste.get_selected_theme();wp_content.setTheme(a);wppaste.update_paste_settings({theme:wppaste.get_selected_theme_name()})},save_paste_settings:function(){var a=
JSON.stringify({lang:wppaste.get_selected_lang(),author:wppaste.get_paste_author(),theme:wppaste.get_selected_theme_name()});return $.cookie("pastesettings",a,{expires:365,path:"/"})},set_selected_mode:function(a){for(var b=document.getElementById("langselect"),c=b.options.length,d=0;d<c;d++)if(a==$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_mode_change(),!0;console.log('No mode named: "'+a+'"');b.selectedIndex=0;wppaste.on_mode_change();return!1},set_selected_theme:function(a){for(var b=
document.getElementById("themeselect"),c=b.options.length,d=0;d<c;d++)if(a==$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_theme_change(),!0;console.log('No theme named: "'+a+'"');b.selectedIndex=0;wppaste.on_theme_change();return!1},submit_paste:function(a){a=a?a:{};a.author=wppaste.get_paste_author();a.content=wp_content.getValue();a.title=wppaste.get_paste_title();a.language=wppaste.get_selected_lang();var b=$("#replyto-id").attr("value");a.replyto=b;if(wptools.is_emptystr(a.content))return show_error_msg('<span class="warning-msg">Paste must have some content.</span>'),
!1;a.title||(a.title="Untitled");update_loading_msg("<span>Submitting paste...</span>");$.ajax({type:"post",contentType:"application/json",url:"/apps/paste/submit",data:JSON.stringify(a),dataType:"json",failure:function(a,b,e){console.log("failure: "+b)},complete:function(a,b){if("error"==b)console.log("wp-error response: "+a.responseText);else{var e=JSON.parse(a.responseText);e.status&&"error"===e.status?(show_error_msg('<span class="warning-msg">'+e.message+"</span>"),console.log("error: "+e.message)):
(wppaste.submit_success(e),$("#floater").fadeOut())}},status:{404:function(){console.log("PAGE NOT FOUND!")},500:function(){console.log("A major error occurred.")}}})},submit_success:function(a){a.url&&(wppaste.save_paste_settings(),wptools.navigateto(a.url))},updatejson:function(a,b){if(a){if(!b)return a}else return JSON.stringify(b)||"";var c=JSON.parse(a);if(!c)return a;c=wppaste.updateobject(c,b);return JSON.stringify(c)},update_paste_settings:function(a){var b=$.cookie("pastesettings"),b=b?JSON.parse(b):
{};a=wppaste.updateobject(b,a);a=JSON.stringify(a);return $.cookie("pastesettings",a,{expires:365,path:"/"})},updateobject:function(a,b){if(a){if(!b)return a}else return b;var c={},d;for(d in a)c[d]=a[d];for(var e in b)c[e]?b[e]&&(c[e]=b[e]):c[e]=b[e];return c}};
function setup_ace(a){wp_content=ace.edit("paste-content");wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);wp_content.setFontSize(14);wp_content.getSession().setUseSoftTabs(!0);a&&wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");wppaste.build_lang_menu();wp_themelist=ace.require("ace/ext/themelist");wppaste.build_theme_menu()}
function update_loading_msg(a){$("#floater-msg").html(a);wptools.center_element("#floater");$("#floater");$(this).scrollTop();$("#floater").fadeIn()}function show_error_msg(a){$("#floater-msg").html(a);wptools.center_element("#floater");$("#floater");$(this).scrollTop();$("#floater").fadeIn();setTimeout(function(){kill_message()},3E3)}function kill_message(){$("#floater").fadeOut()};
