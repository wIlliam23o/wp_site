var wpviewer={version:"0.1.0",current_file:"",current_name:"",change_content:function(a){wp_content.setValue(a);wp_content.selection.selectFileStart()},enable_link:function(a,c){var b=a instanceof jQuery?a:$(a),d=b.children(),e=b.attr("onclick");if(!e)return console.log("can't find href for element: "+a),!1;if(c)return 0>e.indexOf("false")&&(b.attr("onclick",e.replace("true","false")),b.removeClass("vertical-menu-item-disabled"),d.removeClass("vertical-menu-item-disabled")),!0;0>e.indexOf("true")&&
(b.attr("onclick",e.replace("false","true")),b.addClass("vertical-menu-item-disabled"),d.addClass("vertical-menu-item-disabled"));return!0},load_file_data:function(a){a=JSON.parse(a.responseText);var c=$("#file-content-box");if("error"===a.status)c.html("<span>"+(a.message||"Sorry, an unknown error occurred.")+"</span>");else if(a.file_content){if(wpviewer.change_content(a.file_content),c=wp_modelist.getModeForPath(a.static_path),wp_content.getSession().setMode(c.mode),$("#file-content").fadeIn(),
null!==a.name&&null!==a.related_url&&($("#project-title-name").html(a.name),$("#project-link").attr("href",a.related_url),$("#project-info").fadeIn()),a.file_short&&a.static_path&&($("#viewer-filename").html(a.file_short),$("#file-link").attr("href","/dl"+a.static_path),a.file_short&&$("#file-info").fadeIn(),wpviewer.set_current_file(a.static_path)),a=a.menu_items){var c=a.length,b,d;if(0===$(".vertical-menu-item").length&&0<c){var e=$(document.createDocumentFragment()),f;$.each(a,function(){b=this[0].replace(/[ ]/g,
"/");d=this[1];var a="false";b===wpviewer.current_file&&(a="true");f=wpviewer.make_menu_item(d,b,a);e.append(f)});$("#file-menu-items").append(e);$("#file-menu").fadeIn()}else $.each($(".vertical-menu-link"),function(){d=$(this).children().text();wpviewer.enable_link(this,d!==wpviewer.current_name)})}}else c.html("<span>Sorry, no content in this file...</span>")},make_menu_item:function(a,c,b){b||(b="false");var d=$(document.createElement("a")),e;e="javascript:";d.attr("href",e+" void(0);");d.attr("class",
"vertical-menu-link");var f=$(document.createElement("li"));f.addClass("vertical-menu-item");"true"===b&&f.addClass("vertical-menu-item-disabled");var g=$(document.createElement("span"));g.addClass("vertical-menu-text");g.text(a);f.append(g);d.append(f);d.attr("onclick",e+" wpviewer.view_file('"+c+"', "+b+");");"true"===b&&d.addClass("vertical-menu-item-disabled");return d},set_current_file:function(a){a&&(wpviewer.current_file="/"===a[0]?a:"/"+a,a=wpviewer.current_file.split("/"),wpviewer.current_name=
a[a.length-1])},setup_ace:function(a){wp_content=ace.edit("file-content");wp_content.$blockScrolling=Infinity;wp_content.setTheme(wptools.default_ace_theme||"ace/theme/solarized_dark");wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);wp_content.setFontSize(14);wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");a&&(a=wp_modelist.getModeForPath(a))&&wp_content.getSession().setMode(a.mode)},update_loading_msg:function(a){$("#floater-msg").html(a);a=$("#floater");
wptools.center(a);var c=$(this).scrollTop();a.css({top:c+200+"px"});a.fadeIn()},view_file:function(a,c){if(c||!a)return!1;var b={file:a};wpviewer.update_loading_msg("<span>Loading file: "+(wpviewer.current_file||a)+"...</span>");$("#file-info").fadeOut();$.ajax({type:"post",contentType:"application/json",url:"/view/file/",data:JSON.stringify(b),dataType:"json",status:{404:function(){console.log("PAGE NOT FOUND!")},500:function(){console.log("A major error occurred.")}}}).fail(function(a,b,c){a=c.message||
"The error was unknown.";console.log("failure: "+b+"\n    "+a);$("#file-content-box").html("<span class='B'>Sorry, an unhandled error occurred. "+a+"</span>")}).done(function(a,b,c){"error"===b?($("#file-content-box").html("<span class='B'>Sorry, either that file doesn't exist, or there was an error processing it.</span>"),console.log("wp-error response: "+c.responseText)):wpviewer.load_file_data(c);$("#floater").fadeOut()})}};
