var wppaste={version:"0.0.3",build_lang_menu:function(){$("#langselect").append(wppaste.build_menu(wp_modelist.modes,"mode","caption"))},build_menu:function(a,b,c){a.sort(function(a,b){return a[c]<b[c]?-1:a[c]>b[c]?1:0});var d=$(document.createDocumentFragment()),e=$(document.createElement("option"));e.attr({val:""});e.text("[none]");d.append(e);var f,g=0;for(g;g<a.length;g++)e=a[g],f=$(document.createElement("option")),f.attr({val:e[b]}),f.text(e[c]),d.append(f);return d},build_theme_menu:function(){$("#themeselect").append(wppaste.build_menu(wp_themelist.themes,
"theme","caption"))},fix_line_breaks:function(a){var b=wp_content.getValue();if(!b)return!1;a=wppaste.split_string(b,a||80);wp_content.getSession().setValue(a.join("\n"));return!0},get_paste_author:function(){return $("#paste-author-entry").val()},get_paste_title:function(){return $("#paste-title-entry").val()},get_selected_lang:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).text()},get_selected_mode:function(){var a=document.getElementById("langselect");
return $(a.options[a.selectedIndex]).attr("val")},get_selected_onhold:function(){var a=document.getElementById("paste-onhold-opt");return null===a?!1:$(a).prop("checked")},get_selected_private:function(){return $("#paste-private-opt").prop("checked")},get_selected_theme:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme_name:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).text()},
kill_message:function(){$("#floater").fadeOut()},load_paste_content:function(){var a=$("#encoded-content").text();a&&wp_content.getSession().setValue(Base64.decode(a))},load_paste_settings:function(a){var b=$.cookie("pastesettings"),c="",d=wptools.default_ace_langname||"Python",e=wptools.default_ace_themename||"Solarized Dark";a=a||{nolangset:!1};b&&(b=JSON.parse(b),c=b.author||"",d=b.lang||d,e=b.theme||e);a.nolangset||wppaste.set_selected_mode(d);wppaste.set_selected_theme(e);$("#paste-author-entry").val(c)},
on_mode_change:function(a){var b=wppaste.get_selected_mode(),c=wp_content.getSession();c.clearAnnotations();c.setMode(b);a&&a.save&&wppaste.update_paste_settings({lang:wppaste.get_selected_lang()})},on_theme_change:function(a){var b=wppaste.get_selected_theme();wp_content.setTheme(b);a&&a.save&&wppaste.update_paste_settings({theme:wppaste.get_selected_theme_name()})},save_paste_settings:function(){var a=JSON.stringify({lang:wppaste.get_selected_lang(),author:wppaste.get_paste_author(),theme:wppaste.get_selected_theme_name()});
return $.cookie("pastesettings",a,{expires:365,path:"/"})},set_editor_size:function(a){a&&($("#paste-content").height(a),wp_content.resize())},set_selected_mode:function(a){var b=document.getElementById("langselect"),c=b.options.length,d=0;for(d;d<c;d++)if(a===$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_mode_change(),!0;console.log('No mode named: "'+a+'"');b.selectedIndex=0;wppaste.on_mode_change();return!1},set_selected_onhold:function(a){var b=document.getElementById("paste-onhold-opt");
b&&(a=a||!1,$(b).attr({checked:a}))},set_selected_private:function(a){var b=document.getElementById("paste-private-opt");a=a||!1;$(b).attr({checked:a})},set_selected_theme:function(a){var b=document.getElementById("themeselect"),c=b.options.length,d=0;for(d;d<c;d++)if(a===$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_theme_change(),!0;console.log('No theme named: "'+a+'"');b.selectedIndex=0;wppaste.on_theme_change();return!1},setup_ace:function(a){wp_content=ace.edit("paste-content");
wp_content.$blockScrolling=Infinity;wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);wp_content.setOptions({fontSize:"14px"});wp_content.getSession().setUseSoftTabs(!0);a&&wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");wppaste.build_lang_menu();wp_themelist=ace.require("ace/ext/themelist");wppaste.build_theme_menu()},show_error_msg:function(a){$("#floater-msg").html(a);wptools.center("#floater");$("#floater").fadeIn();setTimeout(function(){wppaste.kill_message()},
3E3)},split_string:function(a,b){return a.match(new RegExp(".{1,"+b+"}","g"))},submit_paste:function(a){a=a||{};a.author=wppaste.get_paste_author();a.content=wp_content.getValue();a.title=wppaste.get_paste_title();a.language=wppaste.get_selected_lang();a.onhold=wppaste.get_selected_onhold();a["private"]=wppaste.get_selected_private();var b=$("#replyto-id").attr("value");a.replyto=b;if(wptools.is_emptystr(a.content))return wppaste.show_error_msg('<span class="warning-msg">Paste must have some content.</span>'),
!1;a.title||(a.title="Untitled");wppaste.update_loading_msg("<span>Submitting paste...</span>");$.ajax({type:"post",contentType:"application/json",url:"/apps/paste/submit",data:JSON.stringify(a),dataType:"json",status:{404:function(){console.log("Page not found.")},500:function(){console.log("A major error occurred.")}}}).fail(function(a,b,e){a=e.message||"The error was unknown.";console.log("failure: "+b+"\n    msg:"+a);wppaste.show_error_msg('<span class="warning-msg"> An error occurred while submitting. '+
a+"</span>")}).done(function(a,b,e){"error"===b?(console.log("wp-error response: "+e.responseText),e.responseText&&wppaste.show_error_msg('<span class="warning-msg">'+e.responseText+"</span>")):(a=JSON.parse(e.responseText),a.status&&"error"===a.status?(wppaste.show_error_msg('<span class="warning-msg">'+a.message+"</span>"),console.log("submit error: "+a.message)):(wppaste.submit_success(a),$("#floater").fadeOut()))})},submit_success:function(a){a.url&&(wppaste.save_paste_settings(),wptools.navigateto(a.url))},
updatejson:function(a,b){if(!a)return JSON.stringify(b)||"";if(!b)return a;var c=JSON.parse(a);if(!c)return a;c=wppaste.updateobject(c,b);return JSON.stringify(c)},update_loading_msg:function(a){$("#floater-msg").html(a);wptools.center("#floater");$("#floater").fadeIn()},update_paste_settings:function(a){var b=$.cookie("pastesettings"),b=b?JSON.parse(b):{};a=wppaste.updateobject(b,a);a=JSON.stringify(a);return $.cookie("pastesettings",a,{expires:365,path:"/"})},updateobject:function(a,b){if(!a)return b;
if(!b)return a;var c={},d;for(d in a)c.hasOwnProperty(d)&&(c[d]=a[d]);for(var e in b)c[e]?b[e]&&(c[e]=b[e]):c[e]=b[e];return c}};
