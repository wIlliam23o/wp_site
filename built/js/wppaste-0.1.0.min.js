var wppaste={version:"0.1.0",default_paste_settings:{paste_author:"",paste_lang:wptools.default_ace_langname||"Python",paste_theme:wptools.default_ace_themename||"Solarized Dark"},build_lang_menu:function(){$("#langselect").append(wppaste.build_menu(wp_modelist.modes,"mode","caption"))},build_menu:function(a,b,c){a.sort(function(a,b){return a[c]<b[c]?-1:a[c]>b[c]?1:0});var d=$(document.createDocumentFragment()),e=$(document.createElement("option"));e.attr({val:""});e.text("[none]");d.append(e);var f,
g=0;for(g;g<a.length;g++)e=a[g],f=$(document.createElement("option")),f.attr({val:e[b]}),f.text(e[c]),d.append(f);return d},build_theme_menu:function(){$("#themeselect").append(wppaste.build_menu(wp_themelist.themes,"theme","caption"))},fix_line_breaks:function(a){var b=wp_content.getValue();if(!b)return!1;a=wppaste.split_string(b,a||80);wp_content.getSession().setValue(a.join("\n"));return!0},get_paste_author:function(){return $("#paste-author-entry").val()},get_paste_settings:function(){if(!wptools.has_localstorage())return wppaste.get_paste_settings_cookie();
var a=wppaste.default_paste_settings,b=window.localStorage.getItem("paste_author"),c=window.localStorage.getItem("paste_lang"),d=window.localStorage.getItem("paste_theme");null!==b&&(a.paste_author=b);null!==c&&(a.paste_lang=c);null!==d&&(a.paste_theme=d);return a},get_paste_settings_cookie:function(){var a=$.cookie("pastesettings"),a=a?JSON.parse(a):{};return wppaste.update_object(wppaste.default_paste_settings,a)},get_paste_setting_info:function(){return{paste_author:wppaste.get_paste_author(),
paste_lang:wppaste.get_selected_lang(),paste_theme:wppaste.get_selected_theme_name()}},get_paste_title:function(){return $("#paste-title-entry").val()},get_selected_lang:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).text()},get_selected_mode:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_onhold:function(){var a=document.getElementById("paste-onhold-opt");return null===a?!1:$(a).prop("checked")},
get_selected_private:function(){return $("#paste-private-opt").prop("checked")},get_selected_theme:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme_name:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).text()},kill_message:function(){$("#floater").fadeOut()},load_paste_content:function(){var a=$("#encoded-content").text();a&&wp_content.getSession().setValue(Base64.decode(a))},load_paste_settings:function(a){a=
a||{nolangset:!1};var b=wppaste.get_paste_settings();a.nolangset||wppaste.set_selected_mode(b.paste_lang);wppaste.set_selected_theme(b.paste_theme);$("#paste-author-entry").val(b.paste_author)},object_length:function(a){if("undefined"===typeof a)return 0;if(Object.keys)return Object.keys(a).length;var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b+=1);return b},on_author_change:function(){wppaste.update_paste_settings({paste_author:wppaste.get_paste_author()||null})},on_mode_change:function(a){var b=wppaste.get_selected_mode(),
c=wp_content.getSession();c.clearAnnotations();c.setMode(b);a&&a.save&&wppaste.update_paste_settings({paste_lang:wppaste.get_selected_lang()})},on_theme_change:function(a){var b=wppaste.get_selected_theme();wp_content.setTheme(b);a&&a.save&&wppaste.update_paste_settings({paste_theme:wppaste.get_selected_theme_name()})},save_paste_settings:function(a){a="undefined"===typeof a?wppaste.get_paste_setting_info():a;if(!wptools.has_localstorage())return wppaste.save_paste_settings_cookie(a);a.paste_author?
window.localStorage.setItem("paste_author",a.paste_author):null===a.paste_author&&window.localStorage.setItem("paste_author","");a.paste_lang&&window.localStorage.setItem("paste_lang",a.paste_lang);a.paste_theme&&window.localStorage.setItem("paste_theme",a.paste_theme)},save_paste_settings_cookie:function(a){a="undefined"===typeof a?self.get_paste_setting_info():a;null===a.paste_author&&(a.paste_author="");a=JSON.stringify(a);return $.cookie("pastesettings",a,{expires:365,path:"/"})},set_editor_size:function(a){a&&
($("#paste-content").height(a),wp_content.resize())},set_selected_mode:function(a){var b=document.getElementById("langselect"),c=b.options.length,d=0;for(d;d<c;d++)if(a===$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_mode_change(),!0;console.log('No mode named: "'+a+'"');b.selectedIndex=0;wppaste.on_mode_change();return!1},set_selected_onhold:function(a){var b=document.getElementById("paste-onhold-opt");b&&(a=a||!1,$(b).attr({checked:a}))},set_selected_private:function(a){var b=document.getElementById("paste-private-opt");
a=a||!1;$(b).attr({checked:a})},set_selected_theme:function(a){var b=document.getElementById("themeselect"),c=b.options.length,d=0;for(d;d<c;d++)if(a===$(b.options[d]).text())return b.selectedIndex=d,wppaste.on_theme_change(),!0;console.log('No theme named: "'+a+'"');b.selectedIndex=0;wppaste.on_theme_change();return!1},setup_ace:function(a){wp_content=ace.edit("paste-content");wp_content.$blockScrolling=Infinity;wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);wp_content.setOptions({fontSize:"14px"});
wp_content.getSession().setUseSoftTabs(!0);a&&wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");wppaste.build_lang_menu();wp_themelist=ace.require("ace/ext/themelist");wppaste.build_theme_menu()},show_error_msg:function(a){$("#floater-msg").html(a);wptools.center("#floater");$("#floater").fadeIn();setTimeout(function(){wppaste.kill_message()},3E3)},split_string:function(a,b){return a.match(new RegExp(".{1,"+b+"}","g"))},submit_paste:function(a){a=a||{};a.author=wppaste.get_paste_author();
a.content=wp_content.getValue();a.title=wppaste.get_paste_title();a.language=wppaste.get_selected_lang();a.onhold=wppaste.get_selected_onhold();a["private"]=wppaste.get_selected_private();var b=$("#replyto-id").attr("value");a.replyto=b;if(wptools.is_emptystr(a.content))return wppaste.show_error_msg('<span class="warning-msg">Paste must have some content.</span>'),!1;a.title||(a.title="Untitled");wppaste.update_loading_msg("<span>Submitting paste...</span>");$.ajax({type:"post",contentType:"application/json",
url:"/apps/paste/submit",data:JSON.stringify(a),dataType:"json",status:{404:function(){console.log("Page not found.")},500:function(){console.log("A major error occurred.")}}}).fail(function(a,b,e){a=e.message||"The error was unknown.";console.log("failure: "+status+"\n    msg:"+a);wppaste.show_error_msg('<span class="warning-msg"> An error occurred while submitting. '+a+"</span>")}).done(function(a,b,e){"error"===b?(console.log("wp-error response: "+e.responseText),e.responseText&&wppaste.show_error_msg('<span class="warning-msg">'+
e.responseText+"</span>")):(a=JSON.parse(e.responseText),a.status&&"error"===a.status?(wppaste.show_error_msg('<span class="warning-msg">'+a.message+"</span>"),console.log("submit error: "+a.message)):(wppaste.submit_success(a),$("#floater").fadeOut()))})},submit_success:function(a){a.url&&(wppaste.save_paste_settings(),wptools.navigateto(a.url))},update_json:function(a,b){if(!a)return JSON.stringify(b)||"";if(!b)return a;var c=JSON.parse(a);if(!c)return a;c=wppaste.update_object(c,b);return JSON.stringify(c)},
update_loading_msg:function(a){$("#floater-msg").html(a);wptools.center("#floater");$("#floater").fadeIn()},update_object:function(a,b){if(0===wppaste.object_length(b))return a;if(0===wppaste.object_length(a))return b;var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);for(var e in b)c[e]?"undefined"!==typeof b[e]&&(c[e]=b[e]):c[e]=b[e];return c},update_paste_settings:function(a){var b=wppaste.get_paste_settings();a=wppaste.update_object(b,a);return wppaste.save_paste_settings(a)}};
