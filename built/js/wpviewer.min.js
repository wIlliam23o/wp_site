var wpviewer={current_file:"",current_name:"",change_content:function(a){wp_content.setValue(a);wp_content.selection.selectFileStart()},enable_link:function(a,b){var c=a instanceof jQuery?a:$(a),e=c.children(),d=c.attr("onclick");if(!d)return console.log("can't find href for element: "+a),!1;if(b)return 0>d.indexOf("false")&&(c.attr("onclick",d.replace("true","false")),c.removeClass("vertical-menu-item-disabled"),e.removeClass("vertical-menu-item-disabled")),!0;0>d.indexOf("true")&&(c.attr("onclick",
d.replace("false","true")),c.addClass("vertical-menu-item-disabled"),e.addClass("vertical-menu-item-disabled"));return!0},load_file_data:function(a){var b=JSON.parse(a.responseText);a=$("#file-content-box");if("error"===b.status)a.html("<span>"+(b.message||"Sorry, an unknown error occurred.")+"</span>");else if(b.file_content){if(wpviewer.change_content(b.file_content),a=wp_modelist.getModeForPath(b.static_path),wp_content.getSession().setMode(a.mode),$("#file-content").fadeIn(),null!==b.project_alias&&
null!==b.project_name?($("#project-title-name").html(b.project_name),$("#project-link").click(function(){wptools.navigateto("/projects/"+b.project_alias)}),b.project_alias&&$("#project-info").fadeIn()):null!==b.misc_alias&&null!==b.misc_name&&($("#project-title-name").html(b.misc_name),$("#project-link").click(function(){wptools.navigateto("/misc/"+b.misc_alias)}),b.misc_alias&&$("#project-info").fadeIn()),b.file_short&&b.static_path&&($("#viewer-filename").html(b.file_short),$("#file-link").click(function(){wptools.navigateto("/dl/"+
b.static_path)}),b.file_short&&$("#file-info").fadeIn(),wpviewer.set_current_file(b.static_path)),a=b.menu_items){var c=a.length,e,d;if(0===$(".vertical-menu-item").length&&0<c){var f=$(document.createDocumentFragment()),g;$.each(a,function(){e=this[0].replace(/[ ]/g,"/");d=this[1];var a="false";e===wpviewer.current_file&&(a="true");g=wpviewer.make_menu_item(d,e,a);f.append(g)});$("#file-menu-items").append(f);$("#file-menu").fadeIn()}else $.each($(".vertical-menu-link"),function(){d=$(this).children().text();
wpviewer.enable_link(this,d!==wpviewer.current_name)})}}else a.html("<span>Sorry, no content in this file...</span>")},make_menu_item:function(a,b,c){c||(c="false");var e=$(document.createElement("a")),d;d="javascript:";e.attr("href",d+" void(0);");e.attr("class","vertical-menu-link");var f=$(document.createElement("li"));f.addClass("vertical-menu-item");"true"===c&&f.addClass("vertical-menu-item-disabled");var g=$(document.createElement("span"));g.addClass("vertical-menu-text");g.text(a);f.append(g);
e.append(f);e.attr("onclick",d+" wpviewer.view_file('"+b+"', "+c+");");"true"===c&&e.addClass("vertical-menu-item-disabled");return e},set_current_file:function(a){a&&(wpviewer.current_file="/"===a[0]?a:"/"+a,a=wpviewer.current_file.split("/"),wpviewer.current_name=a[a.length-1])},setup_ace:function(a){wp_content=ace.edit("file-content");wp_content.$blockScrolling=Infinity;wp_content.setTheme(wptools.default_ace_theme||"ace/theme/solarized_dark");wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);
wp_content.setFontSize(14);wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");a&&(a=wp_modelist.getModeForPath(a))&&wp_content.getSession().setMode(a.mode)},update_loading_msg:function(a){$("#floater-msg").html(a);a=$("#floater");wptools.center(a);var b=$(this).scrollTop();a.css({top:b+200+"px"});a.fadeIn()},view_file:function(a,b){if(b||!a)return!1;var c={file:a};wpviewer.update_loading_msg("<span>Loading file: "+(wpviewer.current_file||a)+"...</span>");$("#file-info").fadeOut();
$.ajax({type:"post",contentType:"application/json",url:"/view/file/",data:JSON.stringify(c),dataType:"json",status:{404:function(){console.log("PAGE NOT FOUND!")},500:function(){console.log("A major error occurred.")}}}).fail(function(a,b,c){a=c.message||"The error was unknown.";console.log("failure: "+b+"\n    "+a);$("#file-content-box").html("<span class='B'>Sorry, an unhandled error occurred. "+a+"</span>")}).done(function(a,b,c){"error"===b?($("#file-content-box").html("<span class='B'>Sorry, either that file doesn't exist, or there was an error processing it.</span>"),
console.log("wp-error response: "+c.responseText)):wpviewer.load_file_data(c);$("#floater").fadeOut()})}};
